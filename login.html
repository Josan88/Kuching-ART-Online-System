<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login/Register – Kuching ART</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <h1>Kuching ART</h1>
        <p>Autonomous Rapid Transit</p>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#schedules">Schedules</a></li>
          <li><a href="index.html#routes">Routes</a></li>
          <li><a href="index.html#fares">Fares</a></li>
          <li><a href="index.html#contact">Contact</a></li>
          <li><a href="merchandise.html">Merchandise</a></li>
          <li><a href="login.html" class="login-btn">Login / Register</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="auth-section">
    <div class="container">
      <div class="auth-container">
        <div class="auth-tabs">
          <div class="auth-tab active" id="login-tab">Login</div>
          <div class="auth-tab" id="register-tab">Register</div>
        </div>

        <div class="auth-form" id="login-form">
          <h2>Welcome Back</h2>
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input type="email" id="loginEmail" name="email" required />
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input type="password" id="loginPassword" name="password" required />
            </div>
            <div class="form-group">
              <input type="checkbox" id="rememberMe" name="rememberMe" />
              <label for="rememberMe">Remember me</label>
              <a href="#" class="forgot-password">Forgot password?</a>
            </div>
            <button type="submit" class="btn primary-btn">Login</button>
          </form>
          <div class="form-footer">
            <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
          </div>
        </div>

        <div class="auth-form" id="register-form" style="display: none;">
          <h2>Create an Account</h2>
          <form id="registerForm">
            <div class="form-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" name="fullName" required />
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input type="email" id="registerEmail" name="email" required />
            </div>
            <div class="form-group">
              <label for="phoneNumber">Phone Number</label>
              <input type="tel" id="phoneNumber" name="phoneNumber" required />
            </div>
            <div class="form-group">
              <label for="registerPassword">Password</label>
              <input type="password" id="registerPassword" name="password" required />
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input type="password" id="confirmPassword" name="confirmPassword" required />
            </div>
            <div class="form-group">
              <input type="checkbox" id="termsAgree" name="termsAgree" required />
              <label for="termsAgree">I agree to the Terms and Conditions</label>
            </div>
            <button type="submit" class="btn primary-btn">Register</button>
          </form>
          <div class="form-footer">
            <p>Already have an account? <a href="#" id="show-login">Login</a></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <div class="footer-grid">
        <div class="footer-about">
          <h3>About Kuching ART</h3>
          <p>Kuching Autonomous Rapid Transit is Sarawak’s premier public transportation system, providing modern, efficient, and sustainable mobility solutions for the people of Kuching.</p>
        </div>
        <div class="footer-links">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#schedules">Schedules</a></li>
            <li><a href="index.html#routes">Routes</a></li>
            <li><a href="index.html#fares">Fares</a></li>
            <li><a href="index.html#contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-service">
          <h3>Customer Services</h3>
          <ul>
            <li><a href="booking.html">Book Tickets</a></li>
            <li><a href="manage-booking.html">Manage Bookings</a></li>
            <li><a href="cancel-refund.html">Refund Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>
        <div class="footer-newsletter">
          <h3>Newsletter</h3>
          <p>Subscribe to our newsletter for updates and promotions.</p>
          <form>
            <input type="email" placeholder="Your Email Address" required />
            <button type="submit" class="btn">Subscribe</button>
          </form>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Kuching Autonomous Rapid Transit. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Convert this script to a module so we can import PointsLedger -->
  <script type="module">
    import PointsLedger from '/js/models/PointsLedger.js';

    document.addEventListener('DOMContentLoaded', function () {
      const loginTab = document.getElementById('login-tab');
      const registerTab = document.getElementById('register-tab');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');

      loginTab.addEventListener('click', () => {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        loginTab.classList.add('active');
        registerTab.classList.remove('active');
      });

      registerTab.addEventListener('click', () => {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        registerTab.classList.add('active');
        loginTab.classList.remove('active');
      });

      document.getElementById('show-register')
              .addEventListener('click', () => registerTab.click());
      document.getElementById('show-login')
              .addEventListener('click', () => loginTab.click());

      // — REGISTER —  
      document.getElementById('registerForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const email       = document.getElementById('registerEmail').value.trim().toLowerCase();
        const password    = document.getElementById('registerPassword').value;
        const confirmPass = document.getElementById('confirmPassword').value;

        if (password !== confirmPass) {
          alert('Passwords do not match.');
          return;
        }

        // Store user credentials (just password for now):
        localStorage.setItem(email, JSON.stringify({ password }));
        // Mark this user as “logged in”:
        localStorage.setItem('loggedInUser', email);

        // —— NEW: Create a fresh PointsLedger for this user ——
        // Use their email as userID; use same for ledgerID
        const ledgerID = `LEDGER-${Date.now()}`;
        const userLedger = new PointsLedger(ledgerID, email);
        // Persist it under a key like “ledger_<email>”
        localStorage.setItem(
          'ledger_' + email,
          JSON.stringify(userLedger.toJSON())
        );
        // ————————————

        alert('Registration successful! Redirecting …');
        window.location.href = "index.html";
      });

      // — LOGIN — 
      document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const email    = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;

        const stored = localStorage.getItem(email);
        if (!stored) {
          alert('User not found.');
          return;
        }
        const user = JSON.parse(stored);
        if (user.password === password) {
          localStorage.setItem('loggedInUser', email);
          alert('Login successful! Redirecting …');
          if (email.startsWith('admin@')) {
            window.location.href = "admin.html";
          } else {
            window.location.href = "index.html";
          }
        } else {
          alert('Incorrect password.');
        }
      });
    });
  </script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
